(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f111e69a"],{"04d1":function(t,i,s){"use strict";var a=s("342f"),e=a.match(/firefox\/(\d+)/i);t.exports=!!e&&+e[1]},"0d76":function(t,i,s){"use strict";s.d(i,"a",(function(){return e}));var a=s("41cb");function e(t){return Object(a["a"])({mute:!0}).get("/api/cms/topic",{params:{type:t,all:1,status:1}})}},2669:function(t,i,s){"use strict";s("a8e8")},"2ed0":function(t,i,s){"use strict";s("6931")},"4e82":function(t,i,s){"use strict";var a=s("23e7"),e=s("e330"),n=s("59ed"),o=s("7b0b"),r=s("07fa"),c=s("083a"),l=s("577e"),u=s("d039"),d=s("addb"),p=s("a640"),v=s("04d1"),h=s("d998"),m=s("2d00"),f=s("512ce"),g=[],_=e(g.sort),y=e(g.push),b=u((function(){g.sort(void 0)})),x=u((function(){g.sort(null)})),w=p("sort"),k=!u((function(){if(m)return m<70;if(!(v&&v>3)){if(h)return!0;if(f)return f<603;var t,i,s,a,e="";for(t=65;t<76;t++){switch(i=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)g.push({k:i+a,v:s})}for(g.sort((function(t,i){return i.v-t.v})),a=0;a<g.length;a++)i=g[a].k.charAt(0),e.charAt(e.length-1)!==i&&(e+=i);return"DGBEFHACIJK"!==e}})),C=b||!x||!w||!k,z=function(t){return function(i,s){return void 0===s?-1:void 0===i?1:void 0!==t?+t(i,s)||0:l(i)>l(s)?1:-1}};a({target:"Array",proto:!0,forced:C},{sort:function(t){void 0!==t&&n(t);var i=o(this);if(k)return void 0===t?_(i):_(i,t);var s,a,e=[],l=r(i);for(a=0;a<l;a++)a in i&&y(e,i[a]);d(e,z(t)),s=r(e),a=0;while(a<s)i[a]=e[a++];while(a<l)c(i,a++);return i}})},"512ce":function(t,i,s){"use strict";var a=s("342f"),e=a.match(/AppleWebKit\/(\d+)\./);t.exports=!!e&&+e[1]},6931:function(t,i,s){},"759a":function(t,i,s){"use strict";s.r(i);s("b0c0"),s("99af");var a=function(){var t=this,i=t._self._c;return i("div",{staticClass:"p-event-blindbox"},[i("el-image",{staticClass:"m-bg",attrs:{src:"".concat(t.__imgRoot,"bg.jpg"),fit:"cover"}}),i("div",{staticClass:"p-event-content"},[i("div",{staticClass:"m-content"},[i("div",{staticClass:"m-left"},[i("div",{staticClass:"logo"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"logo.svg"),alt:"魔盒盲盒"}}),i("el-tooltip",{attrs:{effect:"light",placement:"right-start"}},[i("img",{staticClass:"u-info",attrs:{src:"".concat(t.__imgRoot,"desc.svg"),alt:"活动说明"}}),i("div",{staticClass:"m-blindbox-info",attrs:{slot:"content"},slot:"content"},[i("h2",[t._v("活动说明：")]),i("span",[t._v("1.点击盲盒或者右侧按钮可以打开盲盒，每次消耗一定数量的银铛；")]),i("span",[t._v("2.虚拟奖品奖励将实时到账，请注意查收站内信息；")]),i("span",[t._v("3.实体奖品需要填写收件信息，并在中奖后7个工作日内发货，请耐心等待；")]),i("span",[t._v("4.本活动最终解释权归魔盒团队所有。")])])])],1),i("div",{staticClass:"m-box",class:{active:t.allActive}},[t._l(t.boxList,(function(s,a){return i("div",{key:a,class:["u-box","",{active:s===t.active}],on:{click:function(i){return t.change(s)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.showBox(a),expression:"showBox(index)"}],key:t.replay+"box"+a,class:"u-img u-img-".concat(a+1),attrs:{src:"".concat(t.__imgRoot,"box.svg"),alt:"奖品"}})])})),t.isLogin?t._e():i("div",{staticClass:"m-mark",on:{click:t.toLogin}}),i("div",{staticClass:"u-mark",class:{active:t.mark||!t.activeList.length}})],2)]),i("div",{staticClass:"m-right"},[i("div",{staticClass:"m-point"},[t._v(t._s(t.points))]),i("div",{staticClass:"m-prize box"},[i("div",{staticClass:"m-title"},[i("img",{staticClass:"u-prize",attrs:{src:"".concat(t.__imgRoot,"prize.png"),alt:"奖品一览"}})]),i("div",{staticClass:"m-scroll"},[i("div",{ref:"scroll",staticClass:"m-scroll-box"},[t._l(t.prizeList,(function(s,a){return i("a",{key:a,staticClass:"u-item",attrs:{href:t.aLink(s),target:"_blank","data-index":a}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:s.name,placement:"top"}},[i("img",{attrs:{src:s.img}})])],1)})),t._l(t.prizeList,(function(s,a){return i("a",{key:"v"+a,staticClass:"u-item",attrs:{href:t.aLink(s),target:"_blank","data-index":a}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:s.name,placement:"top"}},[i("img",{attrs:{src:s.img}})])],1)}))],2)])]),t.draw.length?i("div",{staticClass:"m-lottery"},[t.isLogin?t._e():i("div",{staticClass:"m-mark",on:{click:t.toLogin}}),i("img",{staticClass:"u-img refresh",attrs:{src:"".concat(t.__imgRoot,"refresh.svg"),alt:"刷新盲盒"},on:{click:t.refreshBox}}),i("div",{staticClass:"m-random u-img",class:{disabled:!t.activeList.length||t.points<t.draw[0][1]||t.isDrawing},on:{click:t.openBox}},[i("span",{staticClass:"u-price"},[t._v(" x "+t._s(t.draw[0][0]))])]),i("div",{staticClass:"m-open u-img",class:{disabled:t.activeList.length<10||t.points<t.draw[1][1]||t.isDrawing},on:{click:function(i){return t.openBox("all")}}},[i("span",{staticClass:"u-price u-discount"},[t._v(" x "+t._s(t.draw[1][1]))]),i("span",{staticClass:"u-price"},[t._v(" x "+t._s(10*t.draw[0][1]))])]),i("div",{staticClass:"m-history box u-img",class:t.history?"history":"close"},[i("div",{staticClass:"m-title",on:{click:t.openHistory}},[i("img",{staticClass:"u-history",attrs:{src:"".concat(t.__imgRoot,"history.png"),alt:"开盒记录"}}),i("img",{staticClass:"u-close",attrs:{src:"".concat(t.__imgRoot,"close.png"),width:"42px",alt:"关闭"},on:{click:function(i){return i.stopPropagation(),t.closeHistory.apply(null,arguments)}}})]),t.isLogin?t._e():i("div",{staticClass:"m-mark",on:{click:t.toLogin}}),i("History",{attrs:{id:t.ID,show:t.history},on:{update:t.showPrizes}})],1)]):t._e()])])]),i("div",{staticClass:"m-goods",class:{active:t.hasPrize}},[i("div",{staticClass:"m-item"},t._l(t.myPrizes,(function(s,a){return i("div",{key:a,staticClass:"u-item box"},["vip_asset"==s.prize_type?[i("img",{staticClass:"u-img",attrs:{src:"".concat(t.__imgRoot,"points.png")}}),i("span",[t._v(t._s(s.vip_asset_once_give+t.asset[s.vip_asset_type]))])]:t._e(),"thanks"==s.prize_type?[i("img",{staticClass:"u-img",attrs:{src:"".concat(t.__imgRoot,"thanks.png")}}),i("span",[t._v("感谢参与")])]:t._e(),"mall_goods"==s.prize_type?[i("img",{staticClass:"u-img",attrs:{src:s.goods.goods_images[0]}}),i("span",[t._v(t._s(s.goods.title))])]:t._e()],2)})),0),i("img",{staticClass:"u-get",class:{disabled:null!==t.prizesInterval},attrs:{src:"".concat(t.__imgRoot).concat(t.history?"ok":"get",".png"),alt:"拿下"},on:{click:t.closePrize}})])],1)},e=[],n=(s("d81d"),s("cb29"),s("d3b7"),s("159b"),s("14d9"),s("caad"),s("2532"),s("4de4"),s("4e82"),s("c9d2")),o=s("0d76"),r=s("41cb");function c(t){return Object(r["d"])().get("/api/lucky-draw/my/history",{params:t})}function l(t){return Object(r["d"])().get("/api/lucky-draw/my/history/".concat(t,"/details"))}function u(t){return Object(r["d"])().get("/api/lucky-draw/public/details",{params:{id:t}})}function d(t,i){return Object(r["d"])().post("/api/lucky-draw/public/item/".concat(t,"/try-my-lucky?batch=").concat(i))}var p=s("2ef0"),v=function(){var t=this,i=t._self._c;return i("div",{staticClass:"m-history-content"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-table-box",attrs:{data:t.list,align:"left"}},[i("el-table-column",{attrs:{prop:"created_at",label:"抽奖时间"}}),i("el-table-column",{attrs:{prop:"chance_count",width:"140px",label:"抽奖次数"}}),i("el-table-column",{attrs:{label:"状态",width:"140px"},scopedSlots:t._u([{key:"default",fn:function(s){return[i("el-tag",{attrs:{type:2==s.row.status?"success":"info"}},[t._v(" "+t._s(2==s.row.status?"中奖":"未中奖")+" ")])]}}])}),i("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(s){return[2==s.row.status?i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.look(s.row.id)}}},[t._v(" 查看详情 ")]):t._e()]}}])})],1),i("el-pagination",{staticClass:"m-archive-pages",attrs:{background:"",layout:"prev, pager, next","hide-on-single-page":!0,"page-size":t.pageSize,total:t.total,"current-page":t.index},on:{"update:currentPage":function(i){t.index=i},"update:current-page":function(i){t.index=i},"current-change":t.change}})],1)},h=[],m={name:"History",inject:["__imgRoot"],props:["id","show"],data:function(){return{list:[],index:0,pageSize:7,total:0,loading:!1}},watch:{show:{immediate:!0,handler:function(t){t&&this.load(this.id)}}},methods:{load:function(t){var i=this;this.loading=!0;var s={luckyDrawId:t,pageSize:this.pageSize,index:this.index};c(s).then((function(t){i.list=t.data.data.list,i.total=t.data.data.page.total})).finally((function(){i.loading=!1}))},look:function(t){this.$emit("update",t)},change:function(t){this.index=t,this.load(this.id)}}},f=m,g=(s("2669"),s("2877")),_=Object(g["a"])(f,v,h,!1,null,null,null),y=_.exports,b=s("65c2"),x="blindbox",w=[2,3],k={name:"Index",inject:["__imgRoot"],data:function(){return{raw:{},ID:0,draw:{},prizeList:[],points:0,index:0,active:"",allActive:!1,boxList:new Array(10).fill(1).map((function(t,i){return i+1})),activeList:[],replay:0,historyList:[],status:{0:"全部",1:"抽奖中",2:"中奖",3:"未中奖"},asset:{boxcoin:"盒币（重制）",boxcoin_origin:"盒币（缘起）",point:"积分"},mark:!1,history:!1,close:!1,hasPrize:!1,myPrizes:[],scrollInterval:null,prizesInterval:null,isDrawing:!1}},components:{History:y},computed:{data:function(){var t={};return this.raw.forEach((function(i){t[i.subtype]||(t[i.subtype]=[]),t[i.subtype].push(i)})),t},isLogin:function(){return n["a"].isLogin()},optionLeft:function(){return{step:.8,direction:2,hoverStop:!0,openTouch:!1}}},watch:{isLogin:{immediate:!0,handler:function(t){t&&this.myPoints()}}},mounted:function(){this.init()},methods:{init:function(){var t=this;Object(o["a"])(x).then((function(i){t.raw=i.data.data,t.ID=~~t.data.ID[0].title,t.ID&&u(t.ID).then((function(i){var s=i.data.data,a={point:"".concat(t.__imgRoot,"points.png"),boxcoin:"".concat(t.__imgRoot,"boxcoin.png")};t.draw=Object(p["zip"])(s.allow_once_try_count,s.allow_once_try_count_cost_points),t.prizeList=s.prize.map((function(t){return"mall_goods"!=t.prize_type&&a[t.vip_asset_type]?{img:a[t.vip_asset_type],name:"银铛（积分）"}:{id:t.mall_goods.id,img:t.mall_goods.goods_images[0],name:t.mall_goods.title}})),t.scroll(t.prizeList.length);var e=s.user_level_limit,o=n["a"].getLevel(1);e>o&&t.$alert("很抱歉，您的用户等级不足","无法进行当前活动",{type:"error"}),t.refreshBox()}))}))},toLogin:function(){this.$confirm("参与抽奖必须登录, 是否登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n["a"].toLogin()}))},showBox:function(t){return this.activeList.includes(t+1)},aLink:function(t){var i=t.id;return i?b["__Root"]+"vip/mall/"+i:""},myPoints:function(){var t=this;n["a"].getAsset().then((function(i){t.points=(null===i||void 0===i?void 0:i.points)||0}))},scroll:function(t){var i="\n            @keyframes scroll_prize {\n                0% {\n                    transform: translateX(0);\n                }\n                100% {\n                    transform: translateX(-".concat(148*t,"px);\n                }\n            }"),s=document.createElement("style");s.setAttribute("type","text/css"),document.head.appendChild(s),s.sheet.insertRule(i),this.$refs.scroll.style.animation="scroll_prize ".concat(148*t/50,"s linear infinite")},refreshBox:function(){this.allActive=!1,this.activeList=Object(p["cloneDeep"])(this.boxList),this.replay++},openBox:Object(p["throttle"])((function(t){var i=this;if("all"===t)this.allActive=!0,setTimeout((function(){i.activeList=[],i.allActive=!1}),1600),this.hasLucky();else{var s=this.activeList[Math.floor(Math.random()*this.activeList.length)];this.change(s)}}),3e3),change:function(t){var i=this;this.active=t,this.mark=!0,setTimeout((function(){i.activeList=i.activeList.filter((function(i){return i!==t})),i.mark=!1,i.active=""}),1600),this.hasLucky()},hasLucky:function(){var t=this,i=1;this.allActive&&(i=10),this.isDrawing=!0,d(this.ID,i).then((function(i){var s,a=null===(s=i.data)||void 0===s?void 0:s.data.id;t.showPrizes(a,!0),t.myPoints()}))},showPrizes:function(t,i){var s=this;if(t){var a=0,e=function(){l(t).then((function(t){var e;if(a>5)return clearInterval(s.prizesInterval),s.prizesInterval=null,s.$alert("请前往开盒记录查看，如无结果请联系网站管理人员","开盒出现异常",{type:"error"});if(-1!==w.indexOf(null===(e=t.data)||void 0===e?void 0:e.data.status)){var n;if(s.myPrizes=(null===(n=t.data)||void 0===n?void 0:n.data.prizes)||[],i){var o,r,c,l,u=(null===(o=t.data)||void 0===o||null===(r=o.data)||void 0===r||null===(c=r.prizes)||void 0===c?void 0:c.length)||0,d=(null===(l=t.data)||void 0===l?void 0:l.data.chance_count)-u,p=new Array(d).fill({prize_type:"thanks"});s.myPrizes=s.myPrizes.concat(p),s.myPrizes.sort((function(){return.5-Math.random()}))}s.hasPrize=!0,clearInterval(s.prizesInterval),s.prizesInterval=null}else a++}))};i?this.prizesInterval=setInterval(e,1e3):e()}},closePrize:function(){this.hasPrize=!1,this.isDrawing=!1,this.activeList.length||this.refreshBox(),this.myPrizes=[]},openHistory:function(){this.history=!0},closeHistory:function(){this.history=!1}},destroyed:function(){clearInterval(this.scrollInterval)}},C=k,z=(s("2ed0"),Object(g["a"])(C,a,e,!1,null,null,null));i["default"]=z.exports},"81d5":function(t,i,s){"use strict";var a=s("7b0b"),e=s("23cb"),n=s("07fa");t.exports=function(t){var i=a(this),s=n(i),o=arguments.length,r=e(o>1?arguments[1]:void 0,s),c=o>2?arguments[2]:void 0,l=void 0===c?s:e(c,s);while(l>r)i[r++]=t;return i}},a8e8:function(t,i,s){},cb29:function(t,i,s){"use strict";var a=s("23e7"),e=s("81d5"),n=s("44d2");a({target:"Array",proto:!0},{fill:e}),n("fill")},d998:function(t,i,s){"use strict";var a=s("342f");t.exports=/MSIE|Trident/.test(a)}}]);
//# sourceMappingURL=chunk-f111e69a.c622791f.js.map