(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eadd698e"],{"1ed9":function(t,e,a){"use strict";a("3429")},3429:function(t,e,a){},"498a":function(t,e,a){"use strict";var s=a("23e7"),i=a("58a8").trim,n=a("c8d2");s({target:"String",proto:!0,forced:n("trim")},{trim:function(){return i(this)}})},"955d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-event",class:"v-"+t.page_name},[e("div",{staticClass:"p-event-content"},[e("div",{staticClass:"m-top"}),e("Content"),e("div",{staticClass:"m-bottom"},[e("a",{staticClass:"u-link",attrs:{href:t.eventLink,target:"_blank"}}),e("img",{staticClass:"m-man",attrs:{src:t.imgRoot+"man.png"}}),e("img",{staticClass:"m-woman",attrs:{src:t.imgRoot+"woman.png"}})])],1)])},i=[],n=(a("b0c0"),a("ac1f"),a("841c"),a("498a"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-content"},[e("div",{staticClass:"m-user-info"},[e("div",{staticClass:"m-name"},[t.isLogin?[e("img",{staticClass:"u-img",attrs:{src:t.userInfo.avatar}}),e("span",{staticClass:"u-name"},[t._v(t._s(t.userInfo.name))])]:t._e()],2),e("div",{staticClass:"m-button"},[e("el-button",{staticClass:"u-btn u-register",on:{click:t.add}},[t._v("注册铭牌")]),t.isDefaultHost&&t.isLogin?e("el-button",{staticClass:"u-btn u-mine",on:{click:t.changeList}},[t._v(" "+t._s(t.isMyList?"全部铭牌":"我的铭牌")+" ")]):t._e()],1)]),e("div",{staticClass:"m-namespace"},[e("div",{staticClass:"m-tool"},[e("span",{staticClass:"u-title"},[t._v(t._s(t.title))]),e("div",{staticClass:"m-search"},[e("div",{staticClass:"m-tabs"},t._l(t.tabs,(function(a,s){return e("span",{key:s,class:[{active:t.type==a.value},"u-tab"],on:{click:function(e){return t.change(a.value)}}},[t._v(t._s(a.label))])})),0),e("div",{key:"namespace-search",staticClass:"u-search",attrs:{slot:"search-before"},slot:"search-before"},[e("el-input",{staticClass:"u-input",attrs:{placeholder:"请输入搜索内容",clearable:""},on:{clear:t.onSearch},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.search,callback:function(e){t.search="string"===typeof e?e.trim():e},expression:"search"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.onSearch},slot:"append"})],1)],1)])]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-list",class:{isMyList:t.isMyList}},[t.list.length?t._l(t.list,(function(a,s){return e("div",{key:s,staticClass:"m-item"},[e("a",{staticClass:"m-title",attrs:{target:"_blank",href:t.buildLink(a)}},[e("div",{staticClass:"u-title"},[e("i",{staticClass:"el-icon-postcard"}),e("span",[t._v(t._s(a.key))])]),2==a.status?e("el-tag",{staticClass:"u-tag",attrs:{type:"danger"}},[t._v("被驳回")]):t.isMyList?e("el-tag",{staticClass:"u-tag",attrs:{type:a.status?"success":"info"}},[t._v(" "+t._s(a.status?"生效中":"审核中")+" ")]):e("span",{staticClass:"u-tag u-jx3"},[t._v("剑网3.com/"+t._s(a.key))])],1),e("span",{staticClass:"u-desc"},[t._v(t._s(a.desc))]),e("div",{staticClass:"m-info"},[e("div",{staticClass:"m-text"},[a.user?e("span",{staticClass:"u-name"},[e("i",{staticClass:"el-icon-user"}),t._v(t._s(a.user.display_name)+" ")]):t._e(),e("span",[e("i",{staticClass:"el-icon-date"}),t._v(t._s(t.dataFormat(a.created)))])]),e("el-button",{staticClass:"u-edit",attrs:{size:"mini"},on:{click:function(e){return e.stopPropagation(),t.edit(a,s)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(" 编辑 ")])],1)])})):e("span",{staticClass:"m-item m-no-item"},[t._v(" 暂无对应铭牌 ")])],2),e("div",{staticClass:"m-namespace-pages"},[e("el-pagination",{attrs:{background:"",layout:"prev, pager, next","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e}}})],1)]),e("el-dialog",{attrs:{title:"铭牌注册",visible:t.visible,width:"600","before-close":t.close},on:{"update:visible":function(e){t.visible=e}}},[e("Form",{attrs:{data:t.data},on:{close:t.close,update:t.update}})],1)],1)}),c=[],o=(a("caad"),a("2532"),a("d3b7"),a("d81d"),a("9911"),a("159b"),a("b64b"),a("41cb"));function l(t){return Object(o["a"])().get("/api/cms/namespace",{params:t})}function r(t){return Object(o["b"])()({method:"GET",url:"/api/my/namespaces",params:t})}function u(t,e){return Object(o["a"])().put("/api/cms/namespace/".concat(t),e)}function m(t){return Object(o["a"])().post("/api/cms/namespace",t)}function d(t){return Object(o["a"])().get("/api/cms/namespace-key",{params:{key:t}})}var p=a("85e4"),f=a("e4f1"),h=a("65c2"),v=a("2ef0"),b=a("c9d2"),g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-namespace-box"},[e("div",{staticClass:"m-header"},[t._m(0),e("div",{staticClass:"u-count"},[e("span",{staticClass:"u-count-txt"},[t._v(" 当前可建铭牌数： "),e("b",[t._v(t._s(t.count))]),t._v(" 个 ")]),t._m(1)])]),e("el-form",{staticClass:"m-publish-namespace-form",attrs:{rules:t.rules,model:t.form}},[e("el-form-item",{staticClass:"m-input",attrs:{label:"关键词",prop:"key"}},[e("el-input",{attrs:{clearable:"",placeholder:"全局唯一关键词"},on:{blur:function(e){return t.checkAvailable(t.form.key)}},model:{value:t.form.key,callback:function(e){t.$set(t.form,"key",e)},expression:"form.key"}}),t.form.key&&!t.available?e("el-alert",{staticClass:"u-available",attrs:{title:"已有关键词，请重新输入",type:"error","show-icon":""}}):t._e()],1),e("el-form-item",{attrs:{label:"链接",prop:"link"}},[e("el-input",{attrs:{clearable:"",placeholder:"请输入跳转地址"},on:{blur:function(e){return t.checkLink(t.form.key)}},model:{value:t.form.link,callback:function(e){t.$set(t.form,"link",e)},expression:"form.link"}},[e("template",{slot:"prepend"},[t._v("https://")])],2)],1),e("el-form-item",{attrs:{label:"描述"}},[e("el-input",{attrs:{placeholder:"请输入关于铭牌的描述",maxlength:"30","show-word-limit":""},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),e("el-form-item",{attrs:{align:"center"}},[e("el-button",{on:{click:t.close}},[t._v("关闭")]),e("el-button",{staticClass:"u-submit",attrs:{type:"primary",disabled:!t.ready||t.processing},on:{click:t.onSubmit}},[t._v(" 提交 ")])],1)],1)],1)},_=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-tip"},[t._v(' 铭牌是一个可以通过关键词快速访问的功能，例如定义铭牌 "某某气纯宏"，则可以在浏览器地址栏中通过快速输入 '),e("a",{attrs:{href:"https://剑网3.com/某某气纯宏",target:"_blank"}},[e("b",[t._v("剑网3.com/某某气纯宏")])]),t._v(" 访问你输入的链接 ")])},function(){var t=this,e=t._self._c;return e("a",{staticClass:"el-button el-button--primary el-button--mini",attrs:{href:"/vip/namespace?from=dashboard_namespace_create",target:"_blank"}},[e("i",{staticClass:"el-icon-shopping-cart-2"}),t._v(" 购买铭牌 ")])}];a("5319");var y={name:"namespace",props:["data"],data:function(){return{count:0,available:!0,processing:!1,form:{},key:"",rules:{key:[{required:!0,message:"请输入铭牌名称",trigger:"blur"}],link:[{required:!0,message:"请输入链接网址",trigger:"blur"}]}}},computed:{isEditMode:function(){return"edit"==this.data.mode},params:function(){return{key:this.form.key,desc:this.form.desc,link:"https://"+this.form.link,source_type:"custom"}},ready:function(){return this.isEditMode?this.available&&this.form.link:this.available&&this.form.link&&this.count}},watch:{"data.form":{immediate:!0,handler:function(t){(t.link.includes("http://")||t.link.includes("https://"))&&(t.link=t.link.replace(/https?\:\/\//,"")),this.form=t,this.key=t.key}}},methods:{close:function(t){this.$emit("close",t)},checkLink:function(t){if(t){var e=this.form.link;(e.includes("http://")||e.includes("https://"))&&(this.form.link=e.replace(/https?\:\/\//,""))}},checkAvailable:function(t){var e=this;t&&d(t).then((function(t){t.data.data?e.available=!(!e.isEditMode||e.key!=t.data.data.key):e.available=!0}))},onSubmit:function(){var t=this;if(""==this.form.desc){var e=b["a"].getInfo();this.params.desc=e.name+"创建"}this.processing=!0,this.isEditMode?u(this.form.ID,this.params).then((function(){t.form.__index=t.data.index,t.onSuccess()})).finally((function(){t.processing=!1})):m(this.params).then((function(e){t.form.user={display_name:""},t.onSuccess(),t.count-=1})).finally((function(){t.processing=!1}))},onSuccess:function(){this.$notify.success({title:"成功",message:"提交成功",showClose:!1}),this.close("success"),this.$emit("update",this.form)}},created:function(){var t=this;b["a"].getAsset().then((function(e){t.count=e.namespace_card_count}))}},k=y,C=(a("d04b"),a("2877")),L=Object(C["a"])(k,g,_,!1,null,null,null),x=L.exports,M={name:"Content",data:function(){return{type:"all",tabs:[{label:"全部",value:"all"},{label:"玩家",value:"player"},{label:"团队",value:"team"},{label:"系统",value:"system"},{label:"自定义",value:"custom"}],list:"",per:8,total:1,page:1,search:"",query:"",loading:!1,isLogin:b["a"].isLogin(),userInfo:b["a"].getInfo(),isMyList:!1,visible:!1,form:{key:"",desc:"",link:""},data:{},isDefaultHost:!location.origin.includes("jx3box.com")}},components:{Form:x},computed:{register_link:function(){return Object(p["publishLink"])("namespace")},params:function(){var t={source_type:"all"==this.type?"":this.type,page:this.page,per:this.per,status:1};return t},title:function(){return this.isMyList?"我的铭牌":"铭牌大厅"}},watch:{type:function(){this.page=1},params:{deep:!0,immediate:!0,handler:function(t){this.query="",this.isMyList?this.loadMyData():this.loadData()}},"$route.query":{deep:!0,immediate:!0,handler:function(t){var e=this;t.namespace&&(this.search=t.namespace,setTimeout((function(){e.onSearch()}),1e3))}}},methods:{change:function(t){this.type=t},loadData:function(){var t=this;this.loading=!0;var e=this.removeEmpty(Object.assign({},this.params,{key:this.search}));l(e).then((function(e){t.list=e.data.data.list.map((function(t){return t._link=Object(v["cloneDeep"])(t.link),t}))||[],t.total=e.data.data.total})).finally((function(){t.loading=!1}))},loadMyData:function(){var t=this;this.loading=!0;var e=this.params,a=e.source_type,s=e.page,i=e.per,n=e.status,c=this.removeEmpty({key:this.search,source_type:a,page:s,limit:i,status:n});r(c).then((function(e){var a=e.data.data.data||[];t.list=a.map((function(t){return t._link=Object(v["cloneDeep"])(t.link),t.user.display_name=t.user.nickname,t})),t.total=e.data.data.total})).finally((function(){t.loading=!1}))},removeEmpty:function(t){return Object.keys(t).forEach((function(e){null!==t[e]&&void 0!==t[e]&&""!==t[e]||delete t[e]})),t},onSearch:function(){if(1!=this.page)return this.page=1;this.loadData()},dataFormat:function(t){return t&&Object(f["a"])(1e3*~~t)||"-"},changeList:function(){this.isLogin&&(this.isMyList=!this.isMyList,this.isMyList?this.loadMyData():this.loadData())},close:function(t){this.visible=!1,"success"==t&&this.loadMyData()},add:function(){if(this.isDefaultHost){if(!this.isLogin)return b["a"].toLogin();this.visible=!0,this.data={mode:"add",form:Object(v["cloneDeep"])(this.form)}}else location.href="".concat(h["__Root"],"event/namespace")},edit:function(t,e){this.visible=!0,this.data={mode:"edit",form:Object(v["cloneDeep"])(t),index:e}},update:function(t){t.ID?this.list[t.__index]=t:this.isMyList&&this.loadMyData()},buildLink:function(t){return"team"==t.source_type?h["__Root"]+"team/org/"+t.source_id:t._link||h["__Root"]+"?namespace="+t.key}},created:function(){this.query=this.$route.query.namespace}},O=M,j=(a("1ed9"),Object(C["a"])(O,n,c,!1,null,null,null)),D=j.exports,w=a("9616"),E={name:"Index",components:{Content:D},data:function(){return{imgRoot:h["__imgPath"]+"topic/namespace/"}},computed:{page_name:function(){return"namespace"},eventLink:function(){return h["__Root"]+"event"}},created:function(){Object(w["b"])("event","namespace")}},S=E,R=Object(C["a"])(S,s,i,!1,null,null,null);e["default"]=R.exports},c8d2:function(t,e,a){"use strict";var s=a("5e77").PROPER,i=a("d039"),n=a("5899"),c="​᠎";t.exports=function(t){return i((function(){return!!n[t]()||c[t]()!==c||s&&n[t].name!==t}))}},d04b:function(t,e,a){"use strict";a("f05a")},f05a:function(t,e,a){}}]);
//# sourceMappingURL=chunk-eadd698e.a69ee25b.js.map