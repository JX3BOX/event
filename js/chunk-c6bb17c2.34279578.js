(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c6bb17c2"],{"0d76":function(t,i,e){"use strict";e.d(i,"a",(function(){return s}));var a=e("41cb");function s(t){return Object(a["a"])({mute:!0}).get("/api/cms/topic",{params:{type:t,all:1,status:1}})}},"0ed6":function(t,i,e){},"13d5":function(t,i,e){"use strict";var a=e("23e7"),s=e("d58f").left,n=e("a640"),o=e("2d00"),r=e("605d"),c=!r&&o>79&&o<83,l=c||!n("reduce");a({target:"Array",proto:!0,forced:l},{reduce:function(t){var i=arguments.length;return s(this,t,i,i>1?arguments[1]:void 0)}})},"2a78":function(t,i,e){"use strict";e("bbc6")},"51eb":function(t,i,e){"use strict";var a=e("825a"),s=e("485a"),n=TypeError;t.exports=function(t){if(a(this),"string"===t||"default"===t)t="string";else if("number"!==t)throw n("Incorrect hint");return s(this,t)}},5530:function(t,i,e){"use strict";e.d(i,"a",(function(){return n}));e("b64b"),e("a4d3"),e("4de4"),e("d3b7"),e("e439"),e("14d9"),e("159b"),e("dbb4");var a=e("ade3");function s(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);i&&(a=a.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,a)}return e}function n(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?s(Object(e),!0).forEach((function(i){Object(a["a"])(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):s(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}},"759a":function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t._self._c;return i("div",{staticClass:"p-event-blindbox"},[t.isLogin?t._e():i("div",{staticClass:"m-mark",on:{click:t.toLogin}}),i("el-image",{staticClass:"m-bg",attrs:{src:"".concat(t.__imgRoot,"bg.jpg"),fit:"cover"}}),i("div",{staticClass:"p-event-content"},[i("div",{staticClass:"m-content"},[i("div",{staticClass:"m-left"},[i("div",{staticClass:"logo"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"logo.svg"),alt:"魔盒盲盒"}})]),i("div",{staticClass:"m-box",class:{active:t.allActive}},[t._l(t.boxList,(function(e,a){return i("div",{key:a,class:["u-box","",{active:e===t.active}],on:{click:function(i){return t.change(e)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.showBox(a),expression:"showBox(index)"}],key:t.replay+"box"+a,class:"u-img u-img-".concat(a+1),attrs:{src:"".concat(t.__imgRoot,"box.svg"),alt:"奖品"}})])})),i("div",{staticClass:"u-mark",class:{active:t.mark||!t.activeList.length}})],2)]),i("div",{staticClass:"m-right"},[i("div",{staticClass:"m-point"},[t._v(t._s(t.points))]),i("div",{staticClass:"m-prize box"},[i("div",{staticClass:"m-title"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"prize.svg"),alt:"奖品一览"}})]),i("div",{staticClass:"m-item"},[i("div",{ref:"scrollBlock",staticClass:"m-scroll-block",style:{animationDuration:t.animationDuration}},[t._l(t.prizeList,(function(e,a){return i("img",{key:"prize".concat(a),attrs:{src:e},on:{load:t.onLoadPrizeList}})})),t._l(t.prizeList,(function(e,a){return i("img",{key:"prize_end".concat(a),attrs:{src:e},on:{load:t.onLoadPrizeList}})}))],2)])]),i("div",{staticClass:"m-lottery"},[i("img",{staticClass:"u-img refresh",attrs:{src:"".concat(t.__imgRoot,"refresh.svg"),alt:"刷新盲盒"},on:{click:t.refreshBox}}),i("div",{staticClass:"m-random u-img",class:{disabled:!t.activeList.length},on:{click:t.openBox}},[i("span",{staticClass:"u-price"},[t._v(" x "+t._s(t.draw[1]))])]),i("div",{staticClass:"m-open u-img",class:{disabled:!t.activeList.length},on:{click:function(i){return t.openBox("all")}}},[i("span",{staticClass:"u-price u-discount"},[t._v(" x "+t._s(t.draw[10]))]),i("span",{staticClass:"u-price"},[t._v(" x "+t._s(10*t.draw[1]))])]),i("div",{staticClass:"m-history box u-img",class:t.history?"history":"close"},[i("div",{staticClass:"m-title"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"history.png"),width:"120px",alt:"开盒记录"},on:{click:t.openHistory}}),i("img",{staticClass:"u-close",attrs:{src:"".concat(t.__imgRoot,"close.png"),width:"42px",alt:"关闭"},on:{click:t.closeHistory}})]),i("History",{attrs:{id:t.ID,show:t.history},on:{update:t.showPrizes}})],1)])])])]),i("div",{staticClass:"m-goods",class:{active:t.hasPrize}},[i("div",{staticClass:"m-item"},[t.myPrizes.length?t._l(t.myPrizes,(function(e,a){return i("div",{key:a,staticClass:"u-item box"},["vip_asset"==e.prize_type?[i("img",{staticClass:"u-img",attrs:{src:"".concat(t.__imgRoot,"points.png")}}),i("span",[t._v(t._s(e.vip_asset_once_give+t.asset[e.vip_asset_type]))])]:[i("img",{staticClass:"u-img",attrs:{src:e.goods.goods_images[0]}}),i("span",[t._v(t._s(e.goods.title))])]],2)})):i("div",{staticClass:"u-item box"},[i("img",{staticClass:"u-img",attrs:{src:"".concat(t.__imgRoot,"thanks.png")}}),i("span",[t._v("感谢参与")])])],2),i("img",{staticClass:"u-get",attrs:{src:"".concat(t.__imgRoot,"get.png"),alt:"拿下"},on:{click:t.closePrize}})])],1)},s=[],n=e("ade3"),o=e("5530"),r=(e("d81d"),e("cb29"),e("d3b7"),e("159b"),e("14d9"),e("13d5"),e("caad"),e("2532"),e("4de4"),e("c9d2")),c=e("0d76"),l=(e("99af"),e("41cb"));function u(t){return Object(l["d"])().get("/lucky-draw/my/history",{params:t})}function d(t){return Object(l["d"])().get("/lucky-draw/my/history/".concat(t,"/details"))}function f(t){return Object(l["d"])().get("/lucky-draw/public/details",{params:{id:t}})}function p(t,i){return Object(l["d"])().post("/lucky-draw/public/item/".concat(t,"/try-my-lucky?batch=").concat(i))}var h=e("2ef0"),v=function(){var t=this,i=t._self._c;return i("div",{staticClass:"m-history-content"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-table-box",attrs:{data:t.list}},[i("el-table-column",{attrs:{prop:"created_at",label:"抽奖时间"}}),i("el-table-column",{attrs:{prop:"chance_count",label:"抽奖次数",width:"80px"}}),i("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{type:2==e.row.status?"success":"info"}},[t._v(" "+t._s(2==e.row.status?"中奖":"未中奖")+" ")])]}}])}),i("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.status?i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.look(e.row.id)}}},[t._v(" 查看详情 ")]):t._e()]}}])})],1),i("el-pagination",{staticClass:"m-archive-pages",attrs:{background:"",layout:"prev, pager, next","hide-on-single-page":!0,"page-size":t.pageSize,total:t.total,"current-page":t.index},on:{"update:currentPage":function(i){t.index=i},"update:current-page":function(i){t.index=i},"current-change":t.change}})],1)},g=[],m={name:"History",inject:["__imgRoot"],props:["id","show"],data:function(){return{list:[],index:0,pageSize:7,total:0,loading:!1}},watch:{show:{immediate:!0,handler:function(t){t&&this.load(this.id)}}},methods:{load:function(t){var i=this;this.loading=!0;var e={luckyDrawId:t,pageSize:this.pageSize,index:this.index};u(e).then((function(t){i.list=t.data.data.list,i.total=t.data.data.page.total})).finally((function(){i.loading=!1}))},look:function(t){this.$emit("update",t)},change:function(t){this.index=t,this.load(this.id)}}},b=m,y=(e("e79d"),e("2877")),_=Object(y["a"])(b,v,g,!1,null,null,null),w=_.exports,x="blindbox",k={name:"Index",inject:["__imgRoot"],data:function(){return{raw:{},ID:0,draw:{},prizeList:[],points:0,index:0,animationDuration:"0s",active:"",allActive:!1,boxList:new Array(10).fill(1).map((function(t,i){return i+1})),activeList:[],replay:0,historyList:[],status:{0:"全部",1:"抽奖中",2:"中奖",3:"未中奖"},asset:{boxcoin:"盒币（重制）",boxcoin_origin:"盒币（缘起）",point:"积分"},mark:!1,history:!1,close:!1,hasPrize:!1,myPrizes:[]}},components:{History:w},computed:{data:function(){var t={};return this.raw.forEach((function(i){t[i.subtype]||(t[i.subtype]=[]),t[i.subtype].push(i)})),t},isLogin:function(){return r["a"].isLogin()}},watch:{isLogin:{immediate:!0,handler:function(t){var i=this;t&&r["a"].getAsset().then((function(t){i.points=(null===t||void 0===t?void 0:t.points)||0}))}}},mounted:function(){this.init()},methods:{init:function(){var t=this;Object(c["a"])(x).then((function(i){t.raw=i.data.data,t.ID=~~t.data.ID[0].title,t.draw=t.data.draw.reduce((function(t,i){return Object(o["a"])(Object(o["a"])({},t),{},Object(n["a"])({},i.title,i.desc))}),{}),t.ID&&f(t.ID).then((function(i){var e=i.data.data,a={point:"".concat(t.__imgRoot,"points.png"),boxcoin:"".concat(t.__imgRoot,"boxcoin.png")};t.prizeList=e.prize.map((function(t){return"mall_goods"!=t.prize_type&&a[t.vip_asset_type]?a[t.vip_asset_type]:t.mall_goods.goods_images[0]})),t.refreshBox()}))}))},toLogin:function(){this.$confirm("参与抽奖必须登录, 是否登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r["a"].toLogin()}))},showBox:function(t){return this.activeList.includes(t+1)},refreshBox:function(){this.allActive=!1,this.activeList=Object(h["cloneDeep"])(this.boxList),this.replay++},onLoadPrizeList:function(){this.animationDuration="".concat(this.$refs.scrollBlock.offsetWidth/60,"s")},openBox:Object(h["throttle"])((function(t){var i=this;if("all"===t)this.allActive=!0,setTimeout((function(){i.activeList=[],i.hasPrize=!0,i.allActive=!1}),1600),this.hasLucky();else{var e=this.activeList[Math.floor(Math.random()*this.activeList.length)];this.change(e)}}),1e3),change:function(t){var i=this;this.active=t,this.mark=!0,setTimeout((function(){i.activeList=i.activeList.filter((function(i){return i!==t})),i.hasPrize=!0,i.mark=!1,i.active=""}),1600),this.hasLucky()},hasLucky:function(){var t=this,i=1;this.allActive&&(i=10),p(this.ID,i).then((function(i){var e,a=null===(e=i.data)||void 0===e?void 0:e.data.id;t.showPrizes(a,{show:!0})}))},showPrizes:function(t,i){var e=this;t&&(i||(this.hasPrize=!0),d(t).then((function(t){var i;e.myPrizes=(null===(i=t.data)||void 0===i?void 0:i.data.prizes)||[]})))},closePrize:function(){this.hasPrize=!1,this.myPrizes=[]},openHistory:function(){this.history=!0},closeHistory:function(){this.history=!1}}},O=k,z=(e("2a78"),Object(y["a"])(O,a,s,!1,null,null,null));i["default"]=z.exports},8172:function(t,i,e){"use strict";var a=e("e065"),s=e("57b9");a("toPrimitive"),s()},"81d5":function(t,i,e){"use strict";var a=e("7b0b"),s=e("23cb"),n=e("07fa");t.exports=function(t){var i=a(this),e=n(i),o=arguments.length,r=s(o>1?arguments[1]:void 0,e),c=o>2?arguments[2]:void 0,l=void 0===c?e:s(c,e);while(l>r)i[r++]=t;return i}},ade3:function(t,i,e){"use strict";e.d(i,"a",(function(){return o}));var a=e("53ca");e("8172"),e("efec"),e("a4d3"),e("e01a"),e("d3b7"),e("d9e2"),e("a9e3");function s(t,i){if("object"!==Object(a["a"])(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!==Object(a["a"])(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}function n(t){var i=s(t,"string");return"symbol"===Object(a["a"])(i)?i:String(i)}function o(t,i,e){return i=n(i),i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}},bbc6:function(t,i,e){},cb29:function(t,i,e){"use strict";var a=e("23e7"),s=e("81d5"),n=e("44d2");a({target:"Array",proto:!0},{fill:s}),n("fill")},d58f:function(t,i,e){"use strict";var a=e("59ed"),s=e("7b0b"),n=e("44ad"),o=e("07fa"),r=TypeError,c=function(t){return function(i,e,c,l){a(e);var u=s(i),d=n(u),f=o(u),p=t?f-1:0,h=t?-1:1;if(c<2)while(1){if(p in d){l=d[p],p+=h;break}if(p+=h,t?p<0:f<=p)throw r("Reduce of empty array with no initial value")}for(;t?p>=0:f>p;p+=h)p in d&&(l=e(l,d[p],p,u));return l}};t.exports={left:c(!1),right:c(!0)}},dbb4:function(t,i,e){"use strict";var a=e("23e7"),s=e("83ab"),n=e("56ef"),o=e("fc6a"),r=e("06cf"),c=e("8418");a({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(t){var i,e,a=o(t),s=r.f,l=n(a),u={},d=0;while(l.length>d)e=s(a,i=l[d++]),void 0!==e&&c(u,i,e);return u}})},e439:function(t,i,e){"use strict";var a=e("23e7"),s=e("d039"),n=e("fc6a"),o=e("06cf").f,r=e("83ab"),c=!r||s((function(){o(1)}));a({target:"Object",stat:!0,forced:c,sham:!r},{getOwnPropertyDescriptor:function(t,i){return o(n(t),i)}})},e79d:function(t,i,e){"use strict";e("0ed6")},efec:function(t,i,e){"use strict";var a=e("1a2d"),s=e("cb2d"),n=e("51eb"),o=e("b622"),r=o("toPrimitive"),c=Date.prototype;a(c,r)||s(c,r,n)}}]);
//# sourceMappingURL=chunk-c6bb17c2.34279578.js.map