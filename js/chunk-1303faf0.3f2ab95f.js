(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1303faf0"],{"0d16":function(t,i,s){"use strict";s("e359")},"0d76":function(t,i,s){"use strict";s.d(i,"a",(function(){return n}));var o=s("41cb");function n(t){return Object(o["a"])({mute:!0}).get("/api/cms/topic",{params:{type:t,all:1,status:1}})}},6710:function(t,i,s){},"688c":function(t,i,s){"use strict";s("6710")},"759a":function(t,i,s){"use strict";s.r(i);var o=function(){var t=this,i=t._self._c;return i("div",{staticClass:"p-event-blindbox"},[t.isLogin?t._e():i("div",{staticClass:"m-mark",on:{click:t.toLogin}}),i("el-image",{staticClass:"m-bg",attrs:{src:"".concat(t.__imgRoot,"bg.png"),fit:"cover"}}),i("div",{staticClass:"p-event-content"},[i("div",{staticClass:"m-content"},[i("div",{staticClass:"m-left"},[i("div",{staticClass:"logo"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"logo.png"),alt:"魔盒盲盒"}})]),i("div",{staticClass:"m-box",class:{active:t.allActive}},[t._l(t.boxList,(function(s,o){return i("div",{key:o,class:["u-box","",{active:s===t.active}],on:{click:function(i){return t.change(s)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.showBox(o),expression:"showBox(index)"}],key:t.replay+"box"+o,class:"u-img u-img-".concat(o+1),attrs:{src:"".concat(t.__imgRoot,"box.png"),alt:"奖品"}})])})),i("div",{class:["u-mark",{active:t.active}]})],2)]),i("div",{staticClass:"m-right"},[i("div",{staticClass:"m-point"},[t._v(t._s(t.points))]),i("div",{staticClass:"m-prize box"},[i("div",{staticClass:"m-title"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"prize.png"),alt:"奖品一览"}})]),i("div",{staticClass:"m-item"},[i("div",{ref:"scrollBlock",staticClass:"m-scroll-block",style:{animationDuration:t.animationDuration}},[t._l(t.prizeList,(function(s,o){return i("img",{key:"prize".concat(o),attrs:{src:s},on:{load:t.onLoadPrizeList}})})),t._l(t.prizeList,(function(s,o){return i("img",{key:"prize_end".concat(o),attrs:{src:s},on:{load:t.onLoadPrizeList}})}))],2)])]),i("div",{staticClass:"m-lottery"},[i("img",{staticClass:"u-img refresh",attrs:{src:"".concat(t.__imgRoot,"refresh.png"),alt:"刷新盲盒"},on:{click:t.refreshBox}}),i("img",{staticClass:"u-img random",attrs:{src:"".concat(t.__imgRoot,"random.png"),alt:"随机开盒"},on:{click:t.openBox}}),i("img",{staticClass:"u-img open",attrs:{src:"".concat(t.__imgRoot,"open.png"),alt:"十连开盒"},on:{click:function(i){return t.openBox("all")}}}),i("div",{staticClass:"m-history box u-img",class:t.history?"history":"close"},[i("div",{staticClass:"m-title"},[i("img",{attrs:{src:"".concat(t.__imgRoot,"history.png"),alt:"开盒记录"},on:{click:t.openHistory}}),i("img",{staticClass:"u-close",attrs:{src:"".concat(t.__imgRoot,"close.png"),alt:"关闭"},on:{click:t.closeHistory}})]),i("History",{attrs:{id:t.ID,show:t.history},on:{update:t.showPrizes}})],1)])])])]),i("div",{staticClass:"m-goods",class:{active:t.hasPrize}},[i("div",{staticClass:"m-item"},t._l(t.myPrizes,(function(s,o){return i("div",{key:o,staticClass:"u-item box"},["vip_asset"==s.prize_type?[i("img",{attrs:{src:"".concat(t.__imgRoot,"points.png")}}),i("span",[t._v(t._s(s.vip_asset_once_give))])]:[i("img",{attrs:{src:s.goods.goods_images[0]}}),i("span",[t._v(t._s(s.goods.title))])]],2)})),0),i("img",{staticClass:"u-get",attrs:{src:"".concat(t.__imgRoot,"get.png"),alt:"拿下"},on:{click:function(i){t.hasPrize=!1}}})])],1)},n=[],a=(s("d81d"),s("cb29"),s("d3b7"),s("159b"),s("14d9"),s("caad"),s("2532"),s("4de4"),s("c9d2")),e=s("0d76"),c=(s("99af"),s("41cb"));function r(t){return Object(c["d"])().get("/lucky-draw/my/history",{params:t})}function l(t){return Object(c["d"])().get("/lucky-draw/my/history/".concat(t,"/details"))}function u(t){return Object(c["d"])().get("/lucky-draw/public/details",{params:{id:t}})}function d(t,i){return Object(c["d"])().post("/lucky-draw/public/item/".concat(t,"/try-my-lucky?batch=").concat(i))}var m=s("2ef0"),h=function(){var t=this,i=t._self._c;return i("div",{staticClass:"m-history-content"},[i("el-table",{staticClass:"m-table-box",attrs:{data:t.list}},[i("el-table-column",{attrs:{prop:"created_at",label:"抽奖时间"}}),i("el-table-column",{attrs:{prop:"chance_count",label:"抽奖次数",width:"80px"}}),i("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(s){return[i("el-tag",{attrs:{type:2==s.row.status?"success":"info"}},[t._v(" "+t._s(2==s.row.status?"中奖":"未中奖")+" ")])]}}])}),i("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(s){return[2==s.row.status?i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.look(s.row.id)}}},[t._v(" 查看详情 ")]):t._e()]}}])})],1)],1)},p=[],f={name:"History",inject:["__imgRoot"],props:["id","show"],data:function(){return{list:[],index:0,pageSize:20}},watch:{show:{immediate:!0,handler:function(t){t&&this.load(t)}}},methods:{load:function(t){var i=this,s={luckyDrawId:t,pageSize:this.pageSize,index:this.index};r(s).then((function(t){i.list=t.data.data.list}))},look:function(t){this.$emit("update",t)}}},g=f,v=(s("688c"),s("2877")),_=Object(v["a"])(g,h,p,!1,null,null,null),y=_.exports,b="blindbox",x={name:"Index",inject:["__imgRoot"],data:function(){return{ID:0,prizeList:[],points:0,index:0,animationDuration:"0s",active:"",allActive:!1,boxList:new Array(10).fill(1).map((function(t,i){return i+1})),activeList:[],replay:0,historyList:[],status:{0:"全部",1:"抽奖中",2:"中奖",3:"未中奖"},history:!1,close:!1,hasPrize:!1,myPrizes:[]}},components:{History:y},computed:{data:function(){var t={};return this.raw.forEach((function(i){t[i.subtype]||(t[i.subtype]=[]),t[i.subtype].push(i)})),t},isLogin:function(){return a["a"].isLogin()}},watch:{isLogin:{immediate:!0,handler:function(t){var i=this;t&&a["a"].getAsset().then((function(t){i.points=(null===t||void 0===t?void 0:t.points)||0}))}}},mounted:function(){this.init()},methods:{init:function(){var t=this;Object(e["a"])(b).then((function(i){t.raw=i.data.data,t.ID=~~t.data.ID[0].title,t.ID&&u(t.ID).then((function(i){var s=i.data.data,o={point:"".concat(t.__imgRoot,"points.png"),boxcoin:"".concat(t.__imgRoot,"boxcoin.png")};t.prizeList=s.prize.map((function(t){return"mall_goods"!=t.prize_type&&o[t.vip_asset_type]?o[t.vip_asset_type]:t.mall_goods.goods_images[0]})),t.refreshBox()}))}))},showBox:function(t){return this.activeList.includes(t+1)},refreshBox:function(){this.allActive=!1,this.activeList=Object(m["cloneDeep"])(this.boxList),this.replay++},onLoadPrizeList:function(){this.animationDuration="".concat(this.$refs.scrollBlock.offsetWidth/60,"s")},change:function(t){var i=this;this.active=t,setTimeout((function(){i.activeList=i.activeList.filter((function(i){return i!==t})),i.show_goods=!0}),1800),this.hasLucky()},openHistory:function(){this.history=!0},closeHistory:function(){this.history=!1},openBox:function(t){var i=this;if("all"===t)this.allActive=!0,setTimeout((function(){i.activeList=[]}),1800),this.hasLucky();else{var s=this.activeList[Math.floor(Math.random()*this.activeList.length)];this.change(s)}},toLogin:function(){this.$confirm("参与抽奖必须登录, 是否登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a["a"].toLogin()}))},hasLucky:function(){var t=this,i=1;this.allActive&&(i=10),d(this.ID,i).then((function(i){var s,o=null===(s=i.data)||void 0===s?void 0:s.data.id;t.showPrizes(o),t.allActive=!1}))},showPrizes:function(t){var i=this;t&&l(t).then((function(t){var s;i.myPrizes=(null===(s=t.data)||void 0===s?void 0:s.data.prizes)||[],console.log(i.myPrizes),i.myPrizes.length&&(i.hasPrize=!0)}))}}},w=x,k=(s("0d16"),Object(v["a"])(w,o,n,!1,null,null,null));i["default"]=k.exports},"81d5":function(t,i,s){"use strict";var o=s("7b0b"),n=s("23cb"),a=s("07fa");t.exports=function(t){var i=o(this),s=a(i),e=arguments.length,c=n(e>1?arguments[1]:void 0,s),r=e>2?arguments[2]:void 0,l=void 0===r?s:n(r,s);while(l>c)i[c++]=t;return i}},cb29:function(t,i,s){"use strict";var o=s("23e7"),n=s("81d5"),a=s("44d2");o({target:"Array",proto:!0},{fill:n}),a("fill")},e359:function(t,i,s){}}]);
//# sourceMappingURL=chunk-1303faf0.3f2ab95f.js.map